<!DOCTYPE html>
<html>
    <head>
        <title>Secure Message Form</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen"/>
    </head>
    <body>
        <script id="publickey" type="text/key">-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG/MacGPG2 v2.0.19 (Darwin)

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
dRYSWOOyRZHqUQ==
=EyKq
-----END PGP PUBLIC KEY BLOCK-----</script>
        <div class="container">
            <div class="row">
                <h3 class="muted">Michael Ballantyne</h3>
            </div>
            <div class="row"><h2>Secure Message Form</h2></div>
            <div class="row"><h4>Send me a secure message, encrypted in your browser with my PGP public key.</div>
            <form id="msgform" action="https://www.mballantyne.net/sendmessage" method="post">
                <!-- textarea does not have a name, so plaintext is not submitted. -->
                <div class="row"><textarea id="msg" class="span12" rows="10"></textarea></div>
                <div class="row"><button type="submit" class="btn">Encrypt and Send</button>
            </form>
        </div>

        <script src="jquery-1.10.1.min.js"></script>
        <script src="openpgp.js"></script>
        <script>
            var submit = function () {
                openpgp.init();
                var publickey = openpgp.read_publicKey($("#publickey").html());
                var plaintext = $("#msg").val();
                var ciphertext = openpgp.write_encrypted_message(publickey, plaintext);
                $('<input>').attr({
                    type: 'hidden',
                    name: 'encrypted',
                    value: ciphertext
                }).appendTo('#msgform');
            };
            $('#msgform').submit(submit);
        </script>
    </body>
</html>
