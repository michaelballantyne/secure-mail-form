<!DOCTYPE html>
<html>
    <head>
        <title>Secure Message Form</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link href="flat/bootstrap/css/bootstrap.css" rel="stylesheet" media="screen"/>
        <link href="flat/css/flat-ui.css" rel="stylesheet" media="screen"/>
        <style>
            .form-horizontal .control-label {
                width: 80px;
            }
            .form-horizontal .controls{
                margin-left: 100px;
            }       

            html,
            body {
                height: 100%;
                /* The html and body elements cannot have any padding or margin. */
            }

            /* Wrapper for page content to push down footer */
            #wrap {
                min-height: 100%;
                height: auto !important;
                height: 100%;
                /* Negative indent footer by it's height */
                margin: 0 auto -40px;
            }

            /* Set the fixed height of the footer here */
            #push,
            #footer {
                height: 40px;
            }
h4 {
    margin-bottom: 2em;
}
 </style>
    </head>
    <body>
        <script id="publickey" type="text/key">-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG/MacGPG2 v2.0.19 (Darwin)

mQENBFG2pz8BCACrcFOuyTDWo1R7arpiPV9OzoPwKjPir7Vl5iRYNvwU1DGUqdP8
FH6v4t9dw96XRAB5Bku3FWcj1AS+vofVMlKv6ZIVczzLQl3uWqEb1MSWZiQf647L
yI1ysQmpPWpydtbUpSXStu9cygffVemCnN6XGagnl96EN8TYQDWZ3/OEbQDsSSbD
4tOVCv55bFNRATOW/A9nRQTT9ztWDj9Xe/OOfwm99zFhRpqpp10kIViWuRyctAih
OSEMYeTnaP5oSK5Yls3wG4Ag6TYLtg9wXKyWvVlQuBHpl2cpth9L2jM6iuiRKKgS
LCaKZ7lK8nBo3vlSAg+NxSsgU0i0bbwwKxRrABEBAAG0MU1pY2hhZWwgQmFsbGFu
dHluZSA8bWljaGFlbC5iYWxsYW50eW5lQGdtYWlsLmNvbT6JAT0EEwEKACcFAlG2
pz8CGy8FCQeGH4AFCwkIBwMFFQoJCAsFFgIDAQACHgECF4AACgkQ+s6emNpbDrmA
uQf/ZNZnb56kUwtiNLWodeqojmvEAeUP/6Up9cZai/1k02MJ5KFd9bQTgKv5vqRZ
cDuHJe6USHbUQq8TKkL/gX5f61g6shQkR30ndI/JFLokxkdY9KbjRauVP/g/lNlQ
W+eyL0XBU4aEXWTlSVNip44AEoFxIdK5WiWRYiMKyJ+Y2YTDJhINwSNFXaUKLTPt
L++gqOIUys102Zu56SuVtQ/cjN1n33lvEhCQZlFZ/xhoAV4dV5iOqif0Bu5zcwj9
CgMVj+ZLwm+aEjtxn3qrapq7y6AKGGIw3hO6obSWIk6w2HQicooUgedG4OibIPFs
fu9bae2Oz2GGCflXR9lyFNmPZLkBDQRRtqc/AQgAk7Ohq4axpqkO2iiTOCWCMrPj
BY2G4A1fPgibLjFTduhSO15KTlclU/1e1Z8dUngJnZB4s26N6ufqCQinWoWc+v1n
QGeUa+xpLQIMPoevpjwl5g258U5H1Pbl0Y8KRce8e64yMvZjA+W3uJCvv+hVZgB+
54bSHymXW8AT9E1I14KYzp1ybQurCYIOzkXkwGiuPOERZAqEoGjW/4BQ002SA4fJ
9nIZLcjKE0VHIc6U1elmbaj0D3ShGHaqdIrOdfg5cwEL/fxr/dM6tWvaZKB4OxQ/
KlfM/loS9w1Fnst3BwFTn5kT6pksxgK9BQzBRmq3xE+vMarlb5LZRJJxir9qlQAR
AQABiQJEBBgBCgAPBQJRtqc/AhsuBQkHhh+AASkJEPrOnpjaWw65wF0gBBkBCgAG
BQJRtqc/AAoJEOtgNYnpfuQrhecH/0OQev/rqjtQ/2sAxbMm4uCAj0pUYxSkv6NA
bsdHMria2Fv/fwXLx6bLbNi+TCoyPQCEDttlKvUXp5MWQtWj9UixHzwwgmjRTPjW
h+GdDux9TtAKCP5cJYulpAMC+HAd4JUUIbdXVc2t1VmGy0zRfrCSoaH9h4De5Q9/
zEZq7mMq0rn8/qShMriKzh6NPjGG329EglptGSE8qXSMF4MIFgAbK9Wn97ByhZ7I
qT0NIZbFlw3tYHr7DMor20+iJ8vMirUZECidrf5wKNWYarKsByCDRi3hWfbcWcNE
xlo68y3J8sqB/Svey2h7v6j+MSY5o1byfCZ2pKbqXdmaEcowPQkP5Qf+OYZdo3sV
ZWhGYtAU2QxtaS4sfrpmDPlYgj/oARAxpY9uAlJrGXvZTeVcE4CMRD78FqIVyty5
TkMx4D1Ccjn1vbcaeajnoKY+l/Du315lnZZQmsugCCmwTSgXTtuIHsP9+9pKeyo3
n4Klmm0esNWoXLxroKLEawzoWvF8Yi9kD9G1pmAq3B7wh6V//2/qYWoZNLIyGpKj
jNuxY/mWxcMLLh9P5VxLGH2CBqfIgsm12QNpcWZ/FmsV66iulaCb5rHXjKth7/SE
RPsxKQizNYXQQeLmXHTvRpikzKSDsnX3Vb/nE/oQH41w0tqSilSeZg5/CDbKJ00A
dRYSWOOyRZHqUQ==
=EyKq
-----END PGP PUBLIC KEY BLOCK-----</script>
<div id="wrap">
    <div class="container">
        <div class="row">
            <h3 class="muted">Michael Ballantyne</h3>
        </div>
        <div class="row">
            <h2>Secure Message Form</h2>
        </div>
        <div class="row">
            <h4>Send me a secure message, encrypted in your browser with my <a href="https://en.wikipedia.org/wiki/Pretty_Good_Privacy">PGP</a> public key.</h4>
        </div>
        <form class="form-horizontal" id="msgform" action="https://www.mballantyne.net/sendmessage" method="post">
            <div class="control-group">
                <label class="control-label" for="from">From</label>
                <div class="controls">
                    <input type="text" id="from" class="span4"></input>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="subject">Subject</label>
                <div class="controls">
                    <input type="text" id="subject" class="span4"></input>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="msg">Message</label>
                <div class="controls">
                    <!-- textarea does not have a name, so plaintext is not submitted. -->
                    <textarea id="msg" class="span12" rows="10"></textarea>
                </div>
            </div>
            <div class="control-group">
                <div class="controls">
                    <button type="submit" class="btn btn-primary">Encrypt and Send</button>
                </div>
            </form>
        </div>
        <div id="push"></div>
    </div>
</div>
<div id="footer" class="text-center">
    <p>Built with <a href="http://twitter.github.io/bootstrap/">Bootstrap</a>, <a href="http://designmodo.github.io/Flat-UI/">Flat UI</a> and <a href="http://openpgpjs.org/">OpenPGP.js</a>.</p>
</div>

        <script src="jquery-1.10.1.min.js"></script>
        <script src="openpgp.js"></script>
        <script>
            var submit = function () {
                openpgp.init();
                var publickey = openpgp.read_publicKey($("#publickey").html());
                var plaintext = ""
                plaintext += "From: " + $("#from").val() + "\n"
                plaintext += "Subject: " + $("#subject").val() + "\n\n"
                plaintext += $("#msg").val();

                var ciphertext = openpgp.write_encrypted_message(publickey, plaintext);

                $('<input>').attr({
                        type: 'hidden',
                        name: 'encrypted',
                        value: ciphertext
                }).appendTo('#msgform');
            };
            $('#msgform').submit(submit);
        </script>
    </body>
</html>
